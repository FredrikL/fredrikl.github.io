---
layout: post
title: Running Selenium with multiple browsers from Rake
categories:
- Code
tags:
- Rake
- Ruby
- Selenium
status: publish
type: post
published: true
meta:
  _edit_last: '2'
---
When your working with <a href="http://seleniumhq.org/">selenium</a> tests in <a href="http://rspec.info/">rspec</a> you might want to run them in multiple browsers. The basic code generated by the selenium ide tool doesn't quite cover it and I couldn't find a good solution on google or <a href="http://stackoverflow.com/">stackoverflow</a>, so here's mine:

First you need a Rakefile that can start &amp; stop <a href="http://seleniumhq.org/projects/remote-control/">selenium-rc</a> and you need a task to run all the spec files. Start and stop tasks are covered in the documentation for the <a href="http://selenium-client.rubyforge.org/">selenium-client</a> gem. To that I've added a list of browsers to test, in my file FireFox, Google Chrome & Internet Explorer, and a rake task that runs the same specs for all browsers, the current settings for cucumber and spec generates a lot of text in it's output so you might want to clean it up a bit. 
Also I pass the browsers to use to the spec files in a environment variable, there might be better ways of doing it but it works and was the fastest way of getting it done.
<pre class="brush:ruby">#Rakefile
require 'selenium/rake/tasks'
require 'rake'
require 'rake/testtask'
require 'spec/rake/spectask'

selenium_jar_file_path  = './tools/test/selenium-server-1.0.3/selenium-server.jar'
browsers = ["*firefox", "*googlechrome", "*iexplore"]

desc "start the selenium-rc server"
Selenium::Rake::RemoteControlStartTask.new("rc") do |rc|
  rc.port = 4444
  rc.timeout_in_seconds = 2 * 60
  rc.background = true
  rc.wait_until_up_and_running = true
  rc.jar_file = selenium_jar_file_path
end

Selenium::Rake::RemoteControlStopTask.new("rc:stop") do |rc|
  rc.host = "localhost"
  rc.port = 4444
  rc.timeout_in_seconds = 3 * 60
end

task :selenium_spec_wrapper do
  browsers.each do |browser|
    ENV['s_browser'] = browser
    rake_system("spec spec/*_spec.rb")
  end
end

task :default =&gt; [:rc, :selenium_spec_wrapper, "rc:stop"]</pre>
In the before(:all) there the client driver is setup I get the environment variable set by the buildscript and use it, the fallback to *firefox is there to use when the script i run from my <a href="http://www.jetbrains.com/ruby/index.html">ide</a> or just by spec.
<pre class="brush:ruby">#spec file
  before(:all) do
    @verification_errors = []
    @selenium_driver = Selenium::Client::Driver.new \
      :host =&gt; "localhost",
      :port =&gt; 4444,
      :browser =&gt; if ENV['s_browser'].nil? == false
					ENV['s_browser']
				else
					"*firefox"
				end,
      :url =&gt; 'http://localhost:3000/sommarkort/',
      :timeout_in_second =&gt; 20
  end</pre>
